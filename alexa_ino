// Power on and start the dishwasher
int controlled1(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin2, value);
    digitalWrite(pin1, LOW);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}

// Select dishwasher cycle

//normal
int controlled2(String args2){
    int pos = args2.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args2.substring(0, pos);
    String strValue = args2.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin2, value);
    digitalWrite(pin1, LOW);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}

//eco
int controlled3(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin1, LOW);
    
    digitalWrite(pin3, value);
    delay(250);
    digitalWrite(pin3, LOW);
    
    digitalWrite(pin2, value);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    
    
    return 1;
}

//rinse
int controlled4(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin1, LOW);
    
    digitalWrite(pin3, value);
    delay(500);
    digitalWrite(pin3, LOW);
    
    digitalWrite(pin2, value);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}

//rapid
int controlled5(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin1, LOW);
    
    digitalWrite(pin3, value);
    delay(1100);
    digitalWrite(pin3, LOW);
    
    digitalWrite(pin2, value);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}

//threeinone
int controlled6(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin1, LOW);
    
    digitalWrite(pin3, value);
    delay(1600);
    digitalWrite(pin3, LOW);
    
    digitalWrite(pin2, value);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}

//intensive
int controlled7(String args){
    int pos = args.indexOf(',');
    
    if(-1 == pos){
        return -1;
    }
    
    String strPin = args.substring(0, pos);
    String strValue = args.substring(pos + 1);
    
    Serial.println();
    Serial.print("Pin: ");
    Serial.print(strPin);
    Serial.print(" ");
    Serial.print("Value: ");
    Serial.print(strValue);
    Serial.println();
    
    int pin1 = D3;
    int pin2 = D4;
    int pin3 = D5;
    int value = HIGH;
    
    if(strValue.equalsIgnoreCase("HIGH")){
        value = HIGH;
    }
    else if(strValue.equalsIgnoreCase("LOW")){
        value = LOW;
    }
    else{
        return -3;
    }
    
    digitalWrite(pin1, value);
    delay(2000);
    digitalWrite(pin1, LOW);
    
    digitalWrite(pin3, value);
    delay(2000);
    digitalWrite(pin3, LOW);
    
    digitalWrite(pin2, value);
    delay(2000);
    digitalWrite(pin2, LOW);
    
    return 1;
}


void setup() {
    Serial.begin(115200);
    
    pinMode(D3, OUTPUT);
    pinMode(D4, OUTPUT);
    pinMode(D5, OUTPUT);
    
    // Particle Functions
    Particle.function("ctrlled", controlled1);
    Particle.function("normal", controlled2);
    Particle.function("eco", controlled3);
    Particle.function("rinse", controlled4);
    Particle.function("rapid", controlled5);
    Particle.function("threeinone", controlled6);
    Particle.function("intensive", controlled7);
}